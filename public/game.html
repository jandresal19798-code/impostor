<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="El Impostor - Juego de deducci√≥n social multijugador en tiempo real">
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Impostor">
    <link rel="icon" type="image/svg+xml" href="/icons/icon.svg">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon.svg">
    <title>üïµÔ∏è El Impostor - Multijugador</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="/css/game.css">
</head>
    <body class="flex items-center justify-center min-h-screen p-4">
        <div id="confetti-container" class="fixed inset-0 pointer-events-none z-50 overflow-hidden"></div>
        
        <div id="connection-status" class="connection-status hidden">
            <div class="status-dot"></div>
            <span id="status-text">Conectando...</span>
        </div>
        
        <button id="music-toggle-btn" onclick="toggleMusic()" class="fixed bottom-4 left-4 z-50 w-10 h-10 rounded-full flex items-center justify-center text-lg cursor-pointer transition-all duration-300" style="background: rgba(30, 41, 59, 0.9); border: 1px solid rgba(99, 102, 241, 0.3);" aria-label="Activar m√∫sica">
            üîá
        </button>
        
        <div class="game-card w-full max-w-md p-8 relative">
        
        <!-- Pantalla de Conexi√≥n -->
        <div id="screen-connect" class="space-y-6">
            <div class="text-center">
                <div class="inline-block animate-float mb-4">
                    <span class="text-6xl">üïµÔ∏è</span>
                </div>
                <h1 class="text-4xl font-black tracking-tight text-white mb-2">IMPOSTOR</h1>
                <p class="text-slate-400 text-sm">Multijugador en tiempo real</p>
            </div>

            <div class="bg-slate-900/50 p-6 rounded-xl space-y-4">
                <div class="text-center">
                    <p class="text-slate-400 text-xs uppercase tracking-widest mb-2">TU NOMBRE</p>
                    <div class="neon-input">
                        <input type="text" id="player-name" placeholder="Ingresa tu nombre" maxlength="15">
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <button onclick="showJoinScreen()" class="neon-btn w-full py-4" aria-label="Unirse a sala">
                    <span>üîó UNIRSE A SALA</span>
                </button>
                <button onclick="showCreateScreen()" class="neon-border-btn w-full py-4" aria-label="Crear nueva sala">
                    üè† CREAR NUEVA SALA
                </button>
                <button onclick="showLocalScreen()" class="neon-border-btn w-full py-4" aria-label="Juego local" style="color: #22c55e;">
                    üì± JUEGO LOCAL
                </button>
            </div>

            <div class="text-center pt-4 border-t border-slate-800">
                <a href="/" class="text-slate-500 text-sm hover:text-slate-300" aria-label="Volver al inicio">‚Üê Volver al inicio</a>
            </div>
        </div>

        <!-- Pantalla de Unirse -->
        <div id="screen-join" class="hidden space-y-6" role="region" aria-label="Pantalla de unirse a sala">
            <div class="text-center">
                <div class="inline-block animate-float mb-4">
                    <span class="text-6xl">üîó</span>
                </div>
                <h1 class="text-2xl font-black tracking-tight text-white mb-2">UNIRSE A SALA</h1>
                <p class="text-slate-400 text-sm">Ingresa el c√≥digo de sala</p>
            </div>

            <div class="bg-slate-900/50 p-6 rounded-xl space-y-4">
                <div class="text-center">
                    <p class="text-slate-400 text-xs uppercase tracking-widest mb-2">C√ìDIGO DE SALA</p>
                    <div class="neon-input">
                        <input type="text" id="room-code-input" placeholder="Ej: ABC123" maxlength="6" style="text-transform: uppercase; text-align: center; font-size: 1.5rem; letter-spacing: 0.3em;" aria-label="C√≥digo de sala">
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <button onclick="joinRoom()" class="neon-btn w-full py-4" aria-label="Confirmar unirse">
                    <span>‚úÖ UNIRSE</span>
                </button>
                <button onclick="showConnectScreen()" class="neon-border-btn w-full py-3" aria-label="Volver">
                    ‚Üê VOLVER
                </button>
            </div>
        </div>

        <!-- Pantalla de Crear Sala -->
        <div id="screen-create" class="hidden space-y-6" role="region" aria-label="Pantalla de crear sala">
            <div class="text-center">
                <div class="inline-block animate-float mb-4">
                    <span class="text-6xl">üè†</span>
                </div>
                <h1 class="text-2xl font-black tracking-tight text-white mb-2">CREAR SALA</h1>
                <p class="text-slate-400 text-sm">Compart√≠ el c√≥digo con tus amigos</p>
            </div>

            <div class="grid grid-cols-4 gap-1.5 p-1.5 bg-slate-900/50 rounded-xl" role="group" aria-label="Selecci√≥n de categor√≠a">
                <button onclick="selectCategory('general')" id="cat-general" class="category-btn active" aria-pressed="true">GENERAL</button>
                <button onclick="selectCategory('peliculas')" id="cat-peliculas" class="category-btn" aria-pressed="false">PEL√çCULAS</button>
                <button onclick="selectCategory('paises')" id="cat-paises" class="category-btn" aria-pressed="false">PA√çSES</button>
                <button onclick="selectCategory('comida')" id="cat-comida" class="category-btn" aria-pressed="false">COMIDA</button>
                <button onclick="selectCategory('tecnologia')" id="cat-tecnologia" class="category-btn" aria-pressed="false">TECNO</button>
                <button onclick="selectCategory('deportes')" id="cat-deportes" class="category-btn" aria-pressed="false">DEPORTES</button>
                <button onclick="selectCategory('animales')" id="cat-animales" class="category-btn" aria-pressed="false">ANIMALES</button>
                <button onclick="selectCategory('colores')" id="cat-colores" class="category-btn" aria-pressed="false">COLORES</button>
                <button onclick="selectCategory('profesiones')" id="cat-profesiones" class="category-btn" aria-pressed="false">PROFES.</button>
                <button onclick="selectCategory('musica')" id="cat-musica" class="category-btn" aria-pressed="false">M√öSICA</button>
                <button onclick="selectCategory('viajes')" id="cat-viajes" class="category-btn" aria-pressed="false">VIAJES</button>
                <button onclick="selectCategory('naturaleza')" id="cat-naturaleza" class="category-btn" aria-pressed="false">NATUR.</button>
                <button onclick="selectCategory('espacio')" id="cat-espacio" class="category-btn" aria-pressed="false">ESPACIO</button>
                <button onclick="selectCategory('historia')" id="cat-historia" class="category-btn" aria-pressed="false">HISTORIA</button>
                <button onclick="selectCategory('arte')" id="cat-arte" class="category-btn" aria-pressed="false">ARTE</button>
                <button onclick="selectCategory('emociones')" id="cat-emociones" class="category-btn" aria-pressed="false">EMOCI√ìN</button>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">IMPOSTORES</span>
                    <div class="flex-1 h-px bg-slate-700"></div>
                </div>
                <div class="flex gap-2 justify-center" id="impostor-count">
                    <button onclick="setImpostorCount(1)" class="count-btn active">1</button>
                    <button onclick="setImpostorCount(2)" class="count-btn">2</button>
                    <button onclick="setImpostorCount(3)" class="count-btn">3</button>
                </div>
            </div>

            <button onclick="createRoom()" class="neon-btn w-full py-4">
                <span>üéÆ CREAR SALA</span>
            </button>
            <button onclick="showConnectScreen()" class="neon-border-btn w-full py-3">
                ‚Üê VOLVER
            </button>
        </div>

        <!-- Pantalla de Lobby -->
        <div id="screen-lobby" class="hidden space-y-6">
            <div class="text-center">
                <div class="inline-block animate-float mb-2">
                    <span class="text-6xl">üïµÔ∏è</span>
                </div>
                <p class="text-slate-400 uppercase tracking-widest text-xs font-bold">C√≥digo de sala</p>
                <div id="room-code-display" class="room-code mx-auto mt-2">---</div>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">JUGADORES</span>
                    <span id="player-count" class="text-xs text-slate-500">0/12</span>
                </div>
                <div id="players-list" class="space-y-2 max-h-48 overflow-y-auto">
                </div>
            </div>

            <button id="btn-start-game" onclick="startGame()" class="neon-btn w-full py-4">
                <span>üöÄ COMENZAR JUEGO</span>
            </button>
            <button onclick="leaveRoom()" class="neon-border-btn w-full py-3 text-slate-400">
                ‚Üê SALIR DE LA SALA
            </button>
        </div>

        <!-- Pantalla de Juego Local -->
        <div id="screen-local" class="hidden space-y-6">
            <div class="text-center">
                <div class="inline-block animate-float mb-4">
                    <span class="text-6xl">üì±</span>
                </div>
                <h1 class="text-2xl font-black tracking-tight text-white mb-2">JUEGO LOCAL</h1>
                <p class="text-slate-400 text-sm">Todos en el mismo dispositivo</p>
            </div>

            <div class="grid grid-cols-4 gap-1.5 p-1.5 bg-slate-900/50 rounded-xl" role="group" aria-label="Selecci√≥n de categor√≠a">
                <button onclick="selectLocalCategory('general')" id="cat-local-general" class="category-btn active">GENERAL</button>
                <button onclick="selectLocalCategory('peliculas')" id="cat-local-peliculas" class="category-btn">PEL√çCULAS</button>
                <button onclick="selectLocalCategory('paises')" id="cat-local-paises" class="category-btn">PA√çSES</button>
                <button onclick="selectLocalCategory('comida')" id="cat-local-comida" class="category-btn">COMIDA</button>
                <button onclick="selectLocalCategory('tecnologia')" id="cat-local-tecnologia" class="category-btn">TECNO</button>
                <button onclick="selectLocalCategory('deportes')" id="cat-local-deportes" class="category-btn">DEPORTES</button>
                <button onclick="selectLocalCategory('animales')" id="cat-local-animales" class="category-btn">ANIMALES</button>
                <button onclick="selectLocalCategory('colores')" id="cat-local-colores" class="category-btn">COLORES</button>
                <button onclick="selectLocalCategory('profesiones')" id="cat-local-profesiones" class="category-btn">PROFES.</button>
                <button onclick="selectLocalCategory('musica')" id="cat-local-musica" class="category-btn">M√öSICA</button>
                <button onclick="selectLocalCategory('viajes')" id="cat-local-viajes" class="category-btn">VIAJES</button>
                <button onclick="selectLocalCategory('naturaleza')" id="cat-local-naturaleza" class="category-btn">NATUR.</button>
                <button onclick="selectLocalCategory('espacio')" id="cat-local-espacio" class="category-btn">ESPACIO</button>
                <button onclick="selectLocalCategory('historia')" id="cat-local-historia" class="category-btn">HISTORIA</button>
                <button onclick="selectLocalCategory('arte')" id="cat-local-arte" class="category-btn">ARTE</button>
                <button onclick="selectLocalCategory('emociones')" id="cat-local-emociones" class="category-btn">EMOCI√ìN</button>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">JUGADORES</span>
                    <div class="flex-1 h-px bg-slate-700"></div>
                    <span id="local-player-count" class="text-xs text-slate-500">0/12</span>
                </div>
                <div id="local-names-container" class="space-y-2 max-h-48 overflow-y-auto">
                </div>
                <div class="flex gap-2 mt-3">
                    <button onclick="addLocalPlayer()" class="flex-1 py-2 rounded-lg border border-dashed border-slate-600 text-slate-400 text-sm font-bold hover:bg-slate-800">
                        + AGREGAR
                    </button>
                    <button onclick="removeLastLocalPlayer()" class="py-2 px-3 rounded-lg border border-dashed border-slate-600 text-slate-400 text-sm">
                        ‚àí
                    </button>
                </div>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">IMPOSTORES</span>
                    <div class="flex-1 h-px bg-slate-700"></div>
                </div>
                <div class="flex gap-2 justify-center" id="local-impostor-count">
                    <button onclick="setLocalImpostorCount(1)" class="count-btn active">1</button>
                    <button onclick="setLocalImpostorCount(2)" class="count-btn">2</button>
                    <button onclick="setLocalImpostorCount(3)" class="count-btn">3</button>
                </div>
            </div>

            <button onclick="startLocalGame()" class="neon-btn w-full py-4">
                <span>üöÄ COMENZAR JUEGO</span>
            </button>
            <button onclick="showConnectScreen()" class="neon-border-btn w-full py-3">
                ‚Üê VOLVER
            </button>
        </div>

        <!-- Pantalla de Espera de Turno -->
        <div id="screen-waiting" class="hidden text-center space-y-6 py-8">
            <div class="space-y-4">
                <div class="w-20 h-20 mx-auto rounded-full bg-slate-900/50 flex items-center justify-center border border-red-500/20">
                    <span class="text-4xl animate-float">‚è≥</span>
                </div>
                <p class="text-slate-400 uppercase tracking-widest text-xs font-bold">Esperando...</p>
                <p id="waiting-message" class="text-white">Otro jugador est√° viendo su rol</p>
            </div>
            <p class="text-slate-500 text-sm">C√≥digo de sala: <span id="waiting-room-code" class="room-code text-lg py-1 px-2"></span></p>
        </div>

        <!-- Pantalla de Revelaci√≥n -->
        <div id="screen-reveal" class="hidden text-center space-y-6 py-8">
            <p class="text-red-500 font-bold uppercase tracking-widest text-xs">Tu palabra es</p>
            <div id="secret-word" class="word-card text-3xl font-black text-white py-16 px-4">
                ---
            </div>
            <div id="role-indicator" class="hidden px-4 py-2 rounded-lg font-bold text-sm"></div>
            <button onclick="handleRevealConfirm()" class="neon-btn w-full py-4">
                <span>‚úÖ YA LA VI</span>
            </button>
        </div>

        <!-- Pantalla de Juego -->
        <div id="screen-playing" class="hidden text-center space-y-6 py-8">
            <div class="inline-block animate-float">
                <span class="text-7xl">üïµÔ∏è‚Äç‚ôÇÔ∏è</span>
            </div>
            <h2 class="text-2xl font-black uppercase text-white">¬°A DEBATIR!</h2>
            
            <div class="bg-slate-900/50 p-4 rounded-xl text-left text-sm text-slate-300 space-y-2">
                <p class="flex items-start gap-2"><span class="text-red-500">‚Ä¢</span> Dec√≠ una palabra relacionada</p>
                <p class="flex items-start gap-2"><span class="text-red-500">‚Ä¢</span> El impostor debe pasar desapercibido</p>
                <p class="flex items-start gap-2"><span class="text-red-500">‚Ä¢</span> ¬°Encontr√° al mentiroso!</p>
            </div>

            <div id="host-controls" class="hidden bg-slate-900/50 p-4 rounded-xl space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-xs text-slate-400 uppercase tracking-wider">TIEMPO</span>
                    <span id="timer-display" class="text-2xl font-black text-red-500">2:00</span>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                    <div id="timer-bar" class="h-full timer-progress rounded-full" style="width: 100%"></div>
                </div>
                <button onclick="startVoting()" class="neon-btn w-full py-3 text-sm">
                    üó≥Ô∏è IR A VOTACI√ìN
                </button>
            </div>

            <div id="player-controls" class="hidden">
                <p class="text-slate-400 text-sm">Esperando al host...</p>
            </div>
        </div>

        <!-- Pantalla de Votaci√≥n -->
        <div id="screen-voting" class="hidden text-center space-y-6 py-8">
            <h2 class="text-xl font-black uppercase">¬øQUI√âN ES EL IMPOSTOR?</h2>
            <p class="text-slate-500 text-xs">Toc√° para votar</p>
            <div id="voting-players" class="space-y-2 max-h-64 overflow-y-auto">
            </div>
            <p class="text-slate-500 text-sm">C√≥digo de sala: <span id="voting-room-code" class="room-code text-lg py-1 px-2"></span></p>
        </div>

        <!-- Pantalla de Resultados -->
        <div id="screen-results" class="hidden text-center space-y-6 py-8">
            <div class="inline-block animate-float text-8xl" id="result-emoji">üéâ</div>
            <h2 id="result-title" class="text-2xl font-black uppercase">¬°RESULTADOS!</h2>
            <div id="result-content" class="result-card p-4 rounded-xl text-left text-sm space-y-2">
            </div>
            <button onclick="resetGame()" class="neon-btn w-full py-4">
                <span>üîÑ JUGAR DE NUEVO</span>
            </button>
            <button onclick="leaveRoom()" class="neon-border-btn w-full py-3 text-slate-400">
                SALIR DE LA SALA
            </button>
        </div>

        </div>

    <script src="/js/game.js"></script>
    <script src="/js/music.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('SW registered:', registration.scope);
            })
            .catch(error => {
              console.log('SW registration failed:', error);
            });
        });
      }
    </script>
</body>
</html>

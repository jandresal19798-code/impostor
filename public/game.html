<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üïµÔ∏è</text></svg>">
    <title>üïµÔ∏è El Impostor - Multijugador</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { font-family: 'Inter', -apple-system, sans-serif; }
        
        body {
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(120, 50, 50, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(80, 50, 120, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, #0b0f1a 0%, #1a1f35 50%, #0b0f1a 100%);
            background-attachment: fixed;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            color: white;
            min-height: 100vh;
        }

        .hidden { display: none !important; }

        .game-card {
            background: rgba(15, 20, 35, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 2rem;
            box-shadow: 
                0 0 0 1px rgba(255,255,255,0.05),
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                0 0 100px -20px rgba(239, 68, 68, 0.1);
            position: relative;
            overflow: hidden;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #ef4444, #f97316, #ef4444, transparent);
            background-size: 200% 100%;
            animation: gradient-shift 3s linear infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .neon-btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #fff;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            border-radius: 1rem;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .neon-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .neon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        .neon-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .neon-border-btn {
            position: relative;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #94a3b8;
            background: transparent;
            border: 2px solid rgba(148, 163, 184, 0.3);
            border-radius: 1rem;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .neon-border-btn:hover {
            color: #fff;
            border-color: rgba(239, 68, 68, 0.5);
            box-shadow: inset 0 0 20px rgba(239, 68, 68, 0.1), 0 0 20px rgba(239, 68, 68, 0.2);
        }

        .category-btn {
            position: relative;
            padding: 0.5rem 0.25rem;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            background: rgba(30, 35, 50, 0.8);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-btn.active {
            color: #fff;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .category-btn:hover:not(.active) {
            color: #94a3b8;
            background: rgba(40, 45, 65, 0.9);
        }

        .neon-input {
            position: relative;
            width: 100%;
        }

        .neon-input input {
            width: 100%;
            padding: 0.875rem 1rem;
            font-size: 0.95rem;
            color: #fff;
            background: rgba(20, 25, 40, 0.8);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 0.75rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .neon-input input::placeholder {
            color: #4b5563;
        }

        .neon-input input:focus {
            border-color: rgba(239, 68, 68, 0.5);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .count-btn {
            width: 2.25rem;
            height: 2.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 700;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(30, 35, 50, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            color: #64748b;
        }

        .count-btn.active {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: transparent;
            color: #fff;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .count-btn:hover:not(.active) {
            background: rgba(50, 55, 75, 0.9);
            border-color: rgba(255,255,255,0.2);
        }

        .word-card {
            background: linear-gradient(145deg, rgba(15, 20, 35, 0.9) 0%, rgba(25, 30, 50, 0.9) 100%);
            border: 2px solid rgba(239, 68, 68, 0.2);
            border-radius: 1.5rem;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.1), inset 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .word-card.impostor {
            border-color: rgba(239, 68, 68, 0.5);
            animation: impostor-glow 1.5s ease-in-out infinite;
        }

        @keyframes impostor-glow {
            0%, 100% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.2); }
            50% { box-shadow: 0 0 50px rgba(239, 68, 68, 0.4); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }

        .timer-progress {
            background: linear-gradient(90deg, #ef4444 0%, #f97316 50%, #ef4444 100%);
            background-size: 200% 100%;
            animation: gradient-scroll 2s linear infinite;
        }

        @keyframes gradient-scroll {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .player-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .player-card {
            background: linear-gradient(135deg, rgba(30, 35, 55, 0.8) 0%, rgba(20, 25, 40, 0.8) 100%);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 0.75rem;
            padding: 0.875rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-card.voted {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(22, 101, 52, 0.2) 100%);
            border-color: rgba(34, 197, 94, 0.3);
        }

        .room-code {
            font-family: monospace;
            letter-spacing: 0.2em;
            background: rgba(239, 68, 68, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: #ef4444;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ef4444;
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .connection-status {
            position: fixed;
            top: 1rem;
            right: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 2rem;
            font-size: 0.75rem;
        }

        .result-card {
            background: linear-gradient(145deg, rgba(25, 30, 50, 0.95) 0%, rgba(15, 20, 35, 0.95) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(239, 68, 68, 0.3);
            border-radius: 3px;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="connection-status" class="connection-status hidden">
        <div class="status-dot"></div>
        <span id="status-text">Conectando...</span>
    </div>
    
    <div id="confetti-container" class="fixed inset-0 pointer-events-none z-50 overflow-hidden"></div>
    
    <div class="game-card w-full max-w-md p-8 relative">
        
        <!-- Pantalla de Conexi√≥n -->
        <div id="screen-connect" class="space-y-6">
            <div class="text-center">
                <div class="inline-block animate-float mb-4">
                    <span class="text-6xl">üïµÔ∏è</span>
                </div>
                <h1 class="text-4xl font-black tracking-tight text-white mb-2">IMPOSTOR</h1>
                <p class="text-slate-400 text-sm">Multijugador en tiempo real</p>
            </div>

            <div class="bg-slate-900/50 p-6 rounded-xl space-y-4">
                <div class="text-center">
                    <p class="text-slate-400 text-xs uppercase tracking-widest mb-2">TU NOMBRE</p>
                    <div class="neon-input">
                        <input type="text" id="player-name" placeholder="Ingresa tu nombre" maxlength="15">
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <button onclick="showJoinScreen()" class="neon-btn w-full py-4">
                    <span>üîó UNIRSE A SALA</span>
                </button>
                <button onclick="showCreateScreen()" class="neon-border-btn w-full py-4">
                    üè† CREAR NUEVA SALA
                </button>
                <button onclick="showLocalScreen()" class="neon-border-btn w-full py-4" style="border-color: rgba(34, 197, 94, 0.3); color: #22c55e;">
                    üì± JUEGO LOCAL
                </button>
            </div>

            <div class="text-center pt-4 border-t border-slate-800">
                <a href="/" class="text-slate-500 text-sm hover:text-slate-300">‚Üê Volver al inicio</a>
            </div>
        </div>

        <!-- Pantalla de Unirse -->
        <div id="screen-join" class="hidden space-y-6">
            <div class="text-center">
                <div class="inline-block animate-float mb-4">
                    <span class="text-6xl">üîó</span>
                </div>
                <h1 class="text-2xl font-black tracking-tight text-white mb-2">UNIRSE A SALA</h1>
                <p class="text-slate-400 text-sm">Ingresa el c√≥digo de sala</p>
            </div>

            <div class="bg-slate-900/50 p-6 rounded-xl space-y-4">
                <div class="text-center">
                    <p class="text-slate-400 text-xs uppercase tracking-widest mb-2">C√ìDIGO DE SALA</p>
                    <div class="neon-input">
                        <input type="text" id="room-code-input" placeholder="Ej: ABC123" maxlength="6" style="text-transform: uppercase; text-align: center; font-size: 1.5rem; letter-spacing: 0.3em;">
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <button onclick="joinRoom()" class="neon-btn w-full py-4">
                    <span>‚úÖ UNIRSE</span>
                </button>
                <button onclick="showConnectScreen()" class="neon-border-btn w-full py-3">
                    ‚Üê VOLVER
                </button>
            </div>
        </div>

        <!-- Pantalla de Crear Sala -->
        <div id="screen-create" class="hidden space-y-6">
            <div class="text-center">
                <div class="inline-block animate-float mb-4">
                    <span class="text-6xl">üè†</span>
                </div>
                <h1 class="text-2xl font-black tracking-tight text-white mb-2">CREAR SALA</h1>
                <p class="text-slate-400 text-sm">Compart√≠ el c√≥digo con tus amigos</p>
            </div>

            <div class="grid grid-cols-4 gap-2 p-1.5 bg-slate-900/50 rounded-xl">
                <button onclick="selectCategory('general')" id="cat-general" class="category-btn active">GENERAL</button>
                <button onclick="selectCategory('peliculas')" id="cat-peliculas" class="category-btn">PEL√çCULAS</button>
                <button onclick="selectCategory('paises')" id="cat-paises" class="category-btn">PA√çSES</button>
                <button onclick="selectCategory('comida')" id="cat-comida" class="category-btn">COMIDA</button>
                <button onclick="selectCategory('tecnologia')" id="cat-tecnologia" class="category-btn">TECNO</button>
                <button onclick="selectCategory('deportes')" id="cat-deportes" class="category-btn">DEPORTES</button>
                <button onclick="selectCategory('animales')" id="cat-animales" class="category-btn">ANIMALES</button>
                <button onclick="selectCategory('colores')" id="cat-colores" class="category-btn">COLORES</button>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">IMPOSTORES</span>
                    <div class="flex-1 h-px bg-slate-700"></div>
                </div>
                <div class="flex gap-2 justify-center" id="impostor-count">
                    <button onclick="setImpostorCount(1)" class="count-btn active">1</button>
                    <button onclick="setImpostorCount(2)" class="count-btn">2</button>
                    <button onclick="setImpostorCount(3)" class="count-btn">3</button>
                </div>
            </div>

            <button onclick="createRoom()" class="neon-btn w-full py-4">
                <span>üéÆ CREAR SALA</span>
            </button>
            <button onclick="showConnectScreen()" class="neon-border-btn w-full py-3">
                ‚Üê VOLVER
            </button>
        </div>

        <!-- Pantalla de Lobby -->
        <div id="screen-lobby" class="hidden space-y-6">
            <div class="text-center">
                <div class="inline-block animate-float mb-2">
                    <span class="text-6xl">üïµÔ∏è</span>
                </div>
                <p class="text-slate-400 uppercase tracking-widest text-xs font-bold">C√≥digo de sala</p>
                <div id="room-code-display" class="room-code mx-auto mt-2">---</div>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">JUGADORES</span>
                    <span id="player-count" class="text-xs text-slate-500">0/12</span>
                </div>
                <div id="players-list" class="space-y-2 max-h-48 overflow-y-auto">
                </div>
            </div>

            <button id="btn-start-game" onclick="startGame()" class="neon-btn w-full py-4">
                <span>üöÄ COMENZAR JUEGO</span>
            </button>
            <button onclick="leaveRoom()" class="neon-border-btn w-full py-3 text-slate-400">
                ‚Üê SALIR DE LA SALA
            </button>
        </div>

        <!-- Pantalla de Juego Local -->
        <div id="screen-local" class="hidden space-y-6">
            <div class="text-center">
                <div class="inline-block animate-float mb-4">
                    <span class="text-6xl">üì±</span>
                </div>
                <h1 class="text-2xl font-black tracking-tight text-white mb-2">JUEGO LOCAL</h1>
                <p class="text-slate-400 text-sm">Todos en el mismo dispositivo</p>
            </div>

            <div class="grid grid-cols-4 gap-2 p-1.5 bg-slate-900/50 rounded-xl">
                <button onclick="selectLocalCategory('general')" id="cat-local-general" class="category-btn active">GENERAL</button>
                <button onclick="selectLocalCategory('peliculas')" id="cat-local-peliculas" class="category-btn">PEL√çCULAS</button>
                <button onclick="selectLocalCategory('paises')" id="cat-local-paises" class="category-btn">PA√çSES</button>
                <button onclick="selectLocalCategory('comida')" id="cat-local-comida" class="category-btn">COMIDA</button>
                <button onclick="selectLocalCategory('tecnologia')" id="cat-local-tecnologia" class="category-btn">TECNO</button>
                <button onclick="selectLocalCategory('deportes')" id="cat-local-deportes" class="category-btn">DEPORTES</button>
                <button onclick="selectLocalCategory('animales')" id="cat-local-animales" class="category-btn">ANIMALES</button>
                <button onclick="selectLocalCategory('colores')" id="cat-local-colores" class="category-btn">COLORES</button>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">JUGADORES</span>
                    <div class="flex-1 h-px bg-slate-700"></div>
                    <span id="local-player-count" class="text-xs text-slate-500">0/12</span>
                </div>
                <div id="local-names-container" class="space-y-2 max-h-48 overflow-y-auto">
                </div>
                <div class="flex gap-2 mt-3">
                    <button onclick="addLocalPlayer()" class="flex-1 py-2 rounded-lg border border-dashed border-slate-600 text-slate-400 text-sm font-bold hover:bg-slate-800">
                        + AGREGAR
                    </button>
                    <button onclick="removeLastLocalPlayer()" class="py-2 px-3 rounded-lg border border-dashed border-slate-600 text-slate-400 text-sm">
                        ‚àí
                    </button>
                </div>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">IMPOSTORES</span>
                    <div class="flex-1 h-px bg-slate-700"></div>
                </div>
                <div class="flex gap-2 justify-center" id="local-impostor-count">
                    <button onclick="setLocalImpostorCount(1)" class="count-btn active">1</button>
                    <button onclick="setLocalImpostorCount(2)" class="count-btn">2</button>
                    <button onclick="setLocalImpostorCount(3)" class="count-btn">3</button>
                </div>
            </div>

            <button onclick="startLocalGame()" class="neon-btn w-full py-4">
                <span>üöÄ COMENZAR JUEGO</span>
            </button>
            <button onclick="showConnectScreen()" class="neon-border-btn w-full py-3">
                ‚Üê VOLVER
            </button>
        </div>

        <!-- Pantalla de Espera de Turno -->
        <div id="screen-waiting" class="hidden text-center space-y-6 py-8">
            <div class="space-y-4">
                <div class="w-20 h-20 mx-auto rounded-full bg-slate-900/50 flex items-center justify-center border border-red-500/20">
                    <span class="text-4xl animate-float">‚è≥</span>
                </div>
                <p class="text-slate-400 uppercase tracking-widest text-xs font-bold">Esperando...</p>
                <p id="waiting-message" class="text-white">Otro jugador est√° viendo su rol</p>
            </div>
            <p class="text-slate-500 text-sm">C√≥digo de sala: <span id="waiting-room-code" class="room-code text-lg py-1 px-2"></span></p>
        </div>

        <!-- Pantalla de Revelaci√≥n -->
        <div id="screen-reveal" class="hidden text-center space-y-6 py-8">
            <p class="text-red-500 font-bold uppercase tracking-widest text-xs">Tu palabra es</p>
            <div id="secret-word" class="word-card text-3xl font-black text-white py-16 px-4">
                ---
            </div>
            <div id="role-indicator" class="hidden px-4 py-2 rounded-lg font-bold text-sm"></div>
            <button onclick="confirmLocalReveal()" class="neon-btn w-full py-4">
                <span>‚úÖ YA LA VI</span>
            </button>
        </div>

        <!-- Pantalla de Juego -->
        <div id="screen-playing" class="hidden text-center space-y-6 py-8">
            <div class="inline-block animate-float">
                <span class="text-7xl">üïµÔ∏è‚Äç‚ôÇÔ∏è</span>
            </div>
            <h2 class="text-2xl font-black uppercase text-white">¬°A DEBATIR!</h2>
            
            <div class="bg-slate-900/50 p-4 rounded-xl text-left text-sm text-slate-300 space-y-2">
                <p class="flex items-start gap-2"><span class="text-red-500">‚Ä¢</span> Dec√≠ una palabra relacionada</p>
                <p class="flex items-start gap-2"><span class="text-red-500">‚Ä¢</span> El impostor debe pasar desapercibido</p>
                <p class="flex items-start gap-2"><span class="text-red-500">‚Ä¢</span> ¬°Encontr√° al mentiroso!</p>
            </div>

            <div id="host-controls" class="hidden bg-slate-900/50 p-4 rounded-xl space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-xs text-slate-400 uppercase tracking-wider">TIEMPO</span>
                    <span id="timer-display" class="text-2xl font-black text-red-500">2:00</span>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                    <div id="timer-bar" class="h-full timer-progress rounded-full" style="width: 100%"></div>
                </div>
                <button onclick="startVoting()" class="neon-btn w-full py-3 text-sm">
                    üó≥Ô∏è IR A VOTACI√ìN
                </button>
            </div>

            <div id="player-controls" class="hidden">
                <p class="text-slate-400 text-sm">Esperando al host...</p>
            </div>
        </div>

        <!-- Pantalla de Votaci√≥n -->
        <div id="screen-voting" class="hidden text-center space-y-6 py-8">
            <h2 class="text-xl font-black uppercase">¬øQUI√âN ES EL IMPOSTOR?</h2>
            <p class="text-slate-500 text-xs">Toc√° para votar</p>
            <div id="voting-players" class="space-y-2 max-h-64 overflow-y-auto">
            </div>
            <p class="text-slate-500 text-sm">C√≥digo de sala: <span id="voting-room-code" class="room-code text-lg py-1 px-2"></span></p>
        </div>

        <!-- Pantalla de Resultados -->
        <div id="screen-results" class="hidden text-center space-y-6 py-8">
            <div class="inline-block animate-float text-8xl" id="result-emoji">üéâ</div>
            <h2 id="result-title" class="text-2xl font-black uppercase">¬°RESULTADOS!</h2>
            <div id="result-content" class="result-card p-4 rounded-xl text-left text-sm space-y-2">
            </div>
            <button onclick="resetGame()" class="neon-btn w-full py-4">
                <span>üîÑ JUGAR DE NUEVO</span>
            </button>
            <button onclick="leaveRoom()" class="neon-border-btn w-full py-3 text-slate-400">
                SALIR DE LA SALA
            </button>
        </div>

    </div>

    <script>
        const socket = io();
        
        let playerName = '';
        let isHost = false;
        let selectedCategory = 'general';
        let impostorCount = 1;
        let myRole = null;
        let playersList = [];

        // Connection status
        socket.on('connect', () => {
            document.getElementById('connection-status').classList.remove('hidden');
            document.getElementById('status-text').textContent = 'Conectado';
            document.querySelector('.status-dot').classList.add('bg-green-500');
            document.querySelector('.status-dot').classList.remove('bg-red-500');
        });

        socket.on('disconnect', () => {
            document.getElementById('status-text').textContent = 'Desconectado';
            document.querySelector('.status-dot').classList.remove('bg-green-500');
            document.querySelector('.status-dot').classList.add('bg-red-500');
        });

        socket.on('connect_error', (err) => {
            console.error('Socket connection error:', err);
            showNotification('Error de conexi√≥n');
        });

        // Screen management
        function showScreen(id) {
            ['screen-connect', 'screen-join', 'screen-create', 'screen-lobby', 'screen-waiting', 'screen-reveal', 'screen-playing', 'screen-voting', 'screen-results'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
        }

        function showConnectScreen() { showScreen('screen-connect'); }
        function showJoinScreen() { showScreen('screen-join'); }
        function showCreateScreen() { showScreen('screen-create'); }
        function showLocalScreen() { 
            showScreen('screen-local'); 
            updateLocalPlayersList();
        }

        // Local game variables
        let localPlayerNames = [];
        let localImpostorCount = 1;
        let localSelectedCategory = 'general';
        let localPlayerRoles = [];
        let localCurrentIndex = 0;

        // Local category selection
        function selectLocalCategory(cat) {
            localSelectedCategory = cat;
            document.querySelectorAll('#screen-local .category-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`cat-local-${cat}`).classList.add('active');
        }

        function setLocalImpostorCount(count) {
            localImpostorCount = count;
            document.querySelectorAll('#local-impostor-count .count-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', idx + 1 === count);
            });
        }

        function addLocalPlayer() {
            const container = document.getElementById('local-names-container');
            const div = document.createElement('div');
            div.className = "flex gap-2";
            div.innerHTML = `
                <div class="neon-input flex-1">
                    <input type="text" placeholder="Nombre..." class="local-player-input" maxlength="15">
                </div>
                <button onclick="this.parentElement.remove(); updateLocalPlayersList();" class="remove-btn">‚úï</button>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function removeLastLocalPlayer() {
            const container = document.getElementById('local-names-container');
            if (container.children.length > 0) {
                container.removeChild(container.lastChild);
            }
            updateLocalPlayersList();
        }

        function updateLocalPlayersList() {
            const inputs = document.querySelectorAll('.local-player-input');
            localPlayerNames = Array.from(inputs).map(i => i.value.trim()).filter(n => n !== "");
            document.getElementById('local-player-count').textContent = `${localPlayerNames.length}/12`;
        }

        function startLocalGame() {
            updateLocalPlayersList();
            
            if (localPlayerNames.length < 3) {
                showNotification('Se necesitan al menos 3 jugadores');
                return;
            }
            if (localPlayerNames.length > 12) {
                showNotification('M√°ximo 12 jugadores');
                return;
            }

            const wordBank = {
                general: ["Pizza", "Par√≠s", "iPhone", "F√∫tbol", "Elefante", "Netflix", "Guitarra", "Dinosaurio", "Chocolate", "Tibur√≥n", "Espada", "Marte", "Cine", "Hamburguesa", "Avi√≥n", "Batman", "Zombi", "Minecraft", "Sushi", "Playa", "Robot", "Nube", "Fuego", "Hielo", "Luna", "Sol", "Estrella", "Tel√©fono", "Reloj", "Cerveza", "Gato", "Perro", "P√°jaro", "Coche", "Casa", "Libro", "Agua", "Tierra", "Viento", "M√∫sica", "Danza"],
                peliculas: ["Matrix", "Titanic", "Avatar", "Gladiador", "Frozen", "Toy Story", "Jurassic Park", "El Rey Le√≥n", "Volver al Futuro", "Star Wars", "Harry Potter", "El Se√±or de los Anillos", "Spider-Man", "Iron Man", "Batman", "Terminator", "Alien", "Depredador", "Jaws", "Psicosis", "Inception", "Interstellar", "Coco", "Encanto", "Moana", "Buscando a Nemo", "Los Incre√≠bles", "Shrek", "Mi Villano Favorito", "Minions"],
                paises: ["Espa√±a", "Francia", "Italia", "Alemania", "Jap√≥n", "Brasil", "Argentina", "M√©xico", "Canad√°", "Estados Unidos", "China", "India", "Australia", "Egipto", "Grecia", "Rusia", "Inglaterra", "Portugal", "Colombia", "Per√∫", "Chile", "Uruguay", "Venezuela", "Cuba", "Corea", "Tailandia", "Vietnam", "Marruecos", "Turqu√≠a"],
                comida: ["Tacos", "Paella", "Sushi", "Pizza", "Hamburguesa", "Lasa√±a", "Curry", "Ramen", "Ceviche", "Empanadas", "Churrasco", "Milanesa", "Feijoada", "Bandeja Paisa", "Arepa", "Patac√≥n", "Causa", "Anticuchos", "Chicha", "Pisco Sour", "Guisado", "Tamales", "Pupusas", "Chimichanga", "Enchiladas", "Tostada", "Gordita", "Quesadilla", "Burrito"],
                tecnologia: ["Computadora", "Internet", "Inteligencia Artificial", "Robot", "Aplicaci√≥n", "Videojuego", "Redes Sociales", "Smartphone", "Tablet", "Wifi", "Bluetooth", "Nube", "Big Data", "Ciberseguridad", "Blockchain", "Criptomoneda", "Realidad Virtual", "Realidad Aumentada", "Drone", "Impresora 3D"],
                deportes: ["F√∫tbol", "Baloncesto", "Tenis", "Nataci√≥n", "Atletismo", "B√©isbol", "F√∫tbol Americano", "Voleibol", "Boxeo", "Artes Marciales", "Gimnasia", "Ciclismo", "Esqu√≠", "Surf", "Escalada", "Golf", "Hockey", "Rugby", "Cr√≠quet", "Ping Pong"],
                animales: ["Le√≥n", "Tigre", "Elefante", "Jirafa", "Mono", "Conejo", "Perro", "Gato", "P√°jaro", "Pez", "Delf√≠n", "Ballena", "Tibur√≥n", "Serpiente", "Lagarto", "Rana", "Tortuga", "Cocodrilo", "Hipop√≥tamo", "Rinoceronte"],
                colores: ["Rojo", "Azul", "Verde", "Amarillo", "Naranja", "Morado", "Rosa", "Negro", "Blanco", "Gris", "Marr√≥n", "Beige", "Celeste", "Turquesa", "Violeta", "Lila", "Dorado", "Plateado", "Cyan", "Magenta"]
            };

            const words = wordBank[localSelectedCategory];
            const secretWord = words[Math.floor(Math.random() * words.length)];
            localPlayerRoles = new Array(localPlayerNames.length).fill(secretWord);
            
            let impostors = new Set();
            while(impostors.size < localImpostorCount) {
                impostors.add(Math.floor(Math.random() * localPlayerNames.length));
            }
            
            impostors.forEach(idx => {
                localPlayerRoles[idx] = { word: "IMPOSTOR", isImpostor: true };
            });

            localCurrentIndex = 0;
            showLocalTransitionScreen();
        }

        function showLocalTransitionScreen() {
            document.getElementById('waiting-message').textContent = `Pas√° el tel√©fono a: ${localPlayerNames[localCurrentIndex].toUpperCase()}`;
            document.getElementById('waiting-room-code').textContent = 'LOCAL';
            showScreen('screen-waiting');
        }

        function confirmLocalReveal() {
            const display = document.getElementById('secret-word');
            const role = localPlayerRoles[localCurrentIndex];
            const indicator = document.getElementById('role-indicator');
            
            if (role.isImpostor) {
                display.innerText = 'üïµÔ∏è IMPOSTOR üïµÔ∏è';
                display.classList.add('impostor');
                indicator.classList.remove('hidden');
                indicator.className = 'px-4 py-2 rounded-lg font-bold text-sm bg-red-600 text-white';
                indicator.innerText = '¬°No tienes palabra!';
            } else {
                display.innerText = role.word;
                display.classList.remove('impostor');
                indicator.classList.remove('hidden');
                indicator.className = 'px-4 py-2 rounded-lg font-bold text-sm bg-green-600 text-white';
                indicator.innerText = '¬°No reveles!';
            }
            
            showScreen('screen-reveal');
        }

        function nextLocalStep() {
            document.getElementById('secret-word').classList.remove('impostor');
            localCurrentIndex++;
            
            if (localCurrentIndex < localPlayerNames.length) {
                showLocalTransitionScreen();
            } else {
                showScreen('screen-playing');
                document.getElementById('host-controls').classList.remove('hidden');
                document.getElementById('player-controls').classList.add('hidden');
            }
        }

        // Category selection
        function selectCategory(cat) {
            selectedCategory = cat;
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`cat-${cat}`).classList.add('active');
            
            if (isHost && playersList.length > 0) {
                socket.emit('update-settings', { category: cat });
            }
        }

        function setImpostorCount(count) {
            impostorCount = count;
            document.querySelectorAll('.count-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', idx + 1 === count);
            });
            
            if (isHost && playersList.length > 0) {
                socket.emit('update-settings', { impostorCount: count });
            }
        }

        // Join room
        function joinRoom() {
            const code = document.getElementById('room-code-input').value.trim().toUpperCase();
            playerName = document.getElementById('player-name').value.trim();
            
            if (!playerName) {
                showNotification('Ingresa tu nombre');
                return;
            }
            if (!code) {
                showNotification('Ingresa el c√≥digo de sala');
                return;
            }

            socket.emit('join-room', { code, name: playerName });
        }

        // Create room
        function createRoom() {
            playerName = document.getElementById('player-name').value.trim();
            
            if (!playerName) {
                showNotification('Ingresa tu nombre');
                return;
            }

            if (!socket.connected) {
                showNotification('Conectando... intenta de nuevo');
                return;
            }

            socket.emit('create-room', playerName);
        }

        // Room joined
        socket.on('room-joined', (data) => {
            isHost = data.isHost;
            playersList = data.players;
            
            document.getElementById('room-code-display').textContent = data.code;
            document.getElementById('waiting-room-code').textContent = data.code;
            document.getElementById('voting-room-code').textContent = data.code;
            
            updatePlayersList();
            showScreen('screen-lobby');
            
            if (isHost) {
                document.getElementById('btn-start-game').classList.remove('hidden');
                socket.emit('update-settings', { 
                    category: selectedCategory, 
                    impostorCount: impostorCount 
                });
            } else {
                document.getElementById('btn-start-game').classList.add('hidden');
            }
        });

        // Players updated
        socket.on('players-updated', (players) => {
            playersList = players;
            updatePlayersList();
        });

        function updatePlayersList() {
            const container = document.getElementById('players-list');
            container.innerHTML = playersList.map(p => `
                <div class="player-card">
                    <span class="font-bold">${p.name}${p.isHost ? ' üëë' : ''}</span>
                    <span class="player-badge">${p.isHost ? 'HOST' : 'JUGADOR'}</span>
                </div>
            `).join('');
            
            document.getElementById('player-count').textContent = `${playersList.length}/12`;
        }

        // Error
        socket.on('error', (msg) => {
            showNotification(msg);
        });

        // Start game
        function startGame() {
            if (playersList.length < 3) {
                showNotification('Se necesitan al menos 3 jugadores');
                return;
            }
            socket.emit('start-game');
        }

        // Game started
        socket.on('game-started', (data) => {
            showScreen('screen-waiting');
            document.getElementById('waiting-message').textContent = 
                `Jugador ${data.currentPlayer + 1} de ${data.totalPlayers} est√° viendo su rol...`;
        });

        // Your role
        socket.on('your-role', (data) => {
            myRole = data.role;
            const display = document.getElementById('secret-word');
            const indicator = document.getElementById('role-indicator');
            
            if (myRole.isImpostor) {
                display.innerText = 'üïµÔ∏è IMPOSTOR üïµÔ∏è';
                display.classList.add('impostor');
                indicator.classList.remove('hidden');
                indicator.className = 'px-4 py-2 rounded-lg font-bold text-sm bg-red-600 text-white';
                indicator.innerText = '¬°No tienes palabra! Debes adivinar.';
            } else {
                display.innerText = myRole.word;
                display.classList.remove('impostor');
                indicator.classList.remove('hidden');
                indicator.className = 'px-4 py-2 rounded-lg font-bold text-sm bg-green-600 text-white';
                indicator.innerText = '¬°No reveles tu palabra!';
            }
            
            showScreen('screen-reveal');
        });

        // Confirm reveal
        function confirmReveal() {
            document.getElementById('secret-word').classList.remove('impostor');
            socket.emit('role-revealed');
        }

        // Next player
        socket.on('next-player', (data) => {
            showScreen('screen-waiting');
            document.getElementById('waiting-message').textContent = 
                `Jugador ${data.currentPlayer + 1} de ${data.totalPlayers} est√° viendo su rol...`;
        });

        // All revealed - start playing
        socket.on('all-revealed', () => {
            showScreen('screen-playing');
            updateGameControls();
        });

        // Timer update
        socket.on('timer-update', (data) => {
            const mins = Math.floor(data.timeLeft / 60);
            const secs = data.timeLeft % 60;
            document.getElementById('timer-display').innerText = `${mins}:${secs.toString().padStart(2, '0')}`;
            document.getElementById('timer-bar').style.width = `${(data.timeLeft / 120) * 100}%`;
        });

        // Timer ended
        socket.on('timer-ended', () => {
            showNotification('¬°Tiempo agotado!');
        });

        // Update game controls
        function updateGameControls() {
            if (isHost) {
                document.getElementById('host-controls').classList.remove('hidden');
                document.getElementById('player-controls').classList.add('hidden');
            } else {
                document.getElementById('host-controls').classList.add('hidden');
                document.getElementById('player-controls').classList.remove('hidden');
            }
        }

        // Start voting
        function startVoting() {
            socket.emit('start-voting');
        }

        // Voting started
        socket.on('voting-started', (data) => {
            showScreen('screen-voting');
            renderVotingPlayers(data.players, data.votes);
        });

        function renderVotingPlayers(players, votes) {
            const container = document.getElementById('voting-players');
            container.innerHTML = players.map(p => `
                <div class="player-card ${p.hasVoted ? 'voted' : ''}" onclick="castVote('${p.name}')">
                    <span class="font-bold">${p.name}</span>
                    <span class="player-badge">${votes[p.name] || 0} votos</span>
                </div>
            `).join('');
        }

        // Cast vote
        function castVote(playerName) {
            socket.emit('cast-vote', playerName);
        }

        // Vote cast
        socket.on('vote-cast', (data) => {
            renderVotingPlayers(data.voters, data.votes);
        });

        // Game results
        socket.on('game-results', (data) => {
            showScreen('screen-results');
            
            if (data.isImpostorEliminated) {
                document.getElementById('result-emoji').innerText = 'üéâ';
                document.getElementById('result-title').innerText = '¬°GANARON LOS CIUDADANOS!';
                document.getElementById('result-title').className = 'text-2xl font-black uppercase text-green-500';
                launchConfetti();
            } else {
                document.getElementById('result-emoji').innerText = 'üòà';
                document.getElementById('result-title').innerText = '¬°GANARON LOS IMPOSTORES!';
                document.getElementById('result-title').className = 'text-2xl font-black uppercase text-red-500';
            }
            
            let content = `<p class="font-bold text-white">${data.eliminated} fue eliminado/a</p>`;
            content += `<p class="text-slate-400 text-xs">Recibi√≥ ${data.maxVotes} votos</p>`;
            
            content += `<p class="font-bold text-white mt-3">Impostores:</p>`;
            data.impostors.forEach(name => {
                content += `<p class="text-red-400 text-sm">üë§ ${name}</p>`;
            });
            
            content += `<p class="font-bold text-white mt-3">Palabra secreta:</p>`;
            content += `<p class="text-green-400 text-sm">${data.secretWord}</p>`;
            
            document.getElementById('result-content').innerHTML = content;
        });

        // Reset game
        function resetGame() {
            socket.emit('reset-game');
        }

        // Game reset
        socket.on('game-reset', (data) => {
            playersList = data.players;
            updatePlayersList();
            showScreen('screen-lobby');
            
            if (isHost) {
                document.getElementById('btn-start-game').classList.remove('hidden');
            } else {
                document.getElementById('btn-start-game').classList.add('hidden');
            }
        });

        // Initialize local game with some players
        function initLocalGame() {
            for(let i=0; i<4; i++) addLocalPlayer();
        }
        
        // Add initial local players on page load
        window.onload = initLocalGame;

        // Leave room
        function leaveRoom() {
            socket.emit('leave-room');
            showConnectScreen();
        }

        // Notifications
        function showNotification(msg) {
            const div = document.createElement('div');
            div.className = "fixed inset-0 flex items-center justify-center z-50 pointer-events-none";
            div.innerHTML = `<div class="bg-red-600 px-6 py-3 rounded-xl font-bold text-sm shadow-2xl animate-bounce">${msg}</div>`;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 2000);
        }

        // Confetti
        function launchConfetti() {
            const container = document.getElementById('confetti-container');
            container.innerHTML = '';
            const colors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#3b82f6', '#a855f7', '#ec4899'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${Math.random() * 100}%;
                    top: -20px;
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    animation: confetti ${Math.random() * 2 + 2}s linear forwards;
                    animation-delay: ${Math.random() * 0.5}s;
                `;
                container.appendChild(confetti);
            }
            
            setTimeout(() => container.innerHTML = '', 4000);
        }
    </script>
</body>
</html>
